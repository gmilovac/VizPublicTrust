<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualization B - Plot 1: Radial Graphs</title>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
      :root {
        --primary-color: #2c5f7f;
        --bg-color: #f8f9fa;
        --text-color: #333;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Page Header */
      .page-header {
        background: linear-gradient(135deg, #2c5f7f 0%, #1a3d4f 100%);
        color: white;
        padding: 2rem 2rem 1.5rem 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .page-header h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
        letter-spacing: -0.5px;
      }
      .page-header .subtitle {
        margin: 0.5rem 0 0 0;
        font-size: 1rem;
        opacity: 0.9;
        font-weight: 400;
      }

      /* File Uploader in Header */
      .header-controls {
        margin-top: 1rem;
        display: flex;
        align-items: center;
        gap: 15px;
      }
      #csv-uploader {
        display: none;
      }
      #upload-label {
        display: inline-block;
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      #upload-label:hover {
        background-color: rgba(255, 255, 255, 0.3);
      }
      #file-name {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.9);
      }

      /* Main Layout */
      .container {
        flex: 1;
        max-width: 1600px;
        margin: 20px auto;
        padding: 0 20px;
        width: 100%;
        box-sizing: border-box;
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 20px;
      }

      /* Controls Panel */
      .controls-panel {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        padding: 20px;
        align-self: start;
      }
      .controls-panel h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
      }
      .control-group {
        margin-bottom: 20px;
      }
      .control-group label {
        display: block;
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 8px;
      }

      /* Agency Checkbox List Styles */
      #agency-checkbox-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #eee;
        border-radius: 6px;
        padding: 10px;
        background: #fcfcfc;
      }
      .checkbox-item {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
      }
      .checkbox-item input {
        margin-right: 8px;
        cursor: pointer;
      }
      .checkbox-item label {
        font-weight: 400;
        margin-bottom: 0;
        cursor: pointer;
        user-select: none;
      }

      /* Info Button & Tooltip Styles */
      .info-wrapper {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-bottom: 20px;
      }
      .info-container {
        position: relative;
        z-index: 10;
        display: flex;
        align-items: center;
      }
      .info-icon {
        width: 28px;
        height: 28px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-family: serif;
        font-style: italic;
        cursor: help;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        font-size: 16px;
      }
      .info-text {
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--primary-color);
        margin-left: 10px;
      }

      .info-tooltip {
        visibility: hidden;
        background-color: #fff;
        color: #333;
        text-align: left;
        border-radius: 8px;
        padding: 15px;
        position: absolute;
        top: -15px;
        left: 105%;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.9rem;
        line-height: 1.4;
        border: 1px solid #eee;
        pointer-events: none;
      }
      .info-container.agency-info .info-tooltip {
        max-height: 70vh;
        overflow-y: auto;
      }

      .info-container:hover .info-tooltip {
        visibility: visible;
        opacity: 1;
      }
      .info-tooltip h4 {
        margin-top: 0;
        color: var(--primary-color);
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
      }
      .info-tooltip strong {
        color: #444;
      }
      .def-item {
        margin-bottom: 8px;
      }
      .agency-list-wrapper {
        display: flex;
        gap: 15px;
        margin-top: 10px;
      }
      .agency-tooltip-table {
        flex: 1;
        border-collapse: collapse;
        font-size: 0.85rem;
      }
      .agency-tooltip-table th,
      .agency-tooltip-table td {
        border-bottom: 1px solid #eee;
        padding: 6px 0;
        text-align: left;
      }
      .agency-tooltip-table th {
        font-weight: bold;
        color: var(--primary-color);
        padding-bottom: 8px;
      }

      /* Comparison List */
      #comparison-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .comparison-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 8px;
        background: #f8f9fa;
      }
      .comparison-item-name {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
      }
      .color-swatch {
        width: 12px;
        height: 12px;
        border-radius: 3px;
        display: inline-block;
        border: 1px solid #33333366;
      }

      /* Visualization Area */
      .viz-area {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .viz-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        padding: 20px;
        position: relative;
        flex: 1;
      }
      .viz-card h3 {
        margin-top: 0;
        color: #333;
      }
      #radar-chart,
      #bar-chart {
        width: 100%;
        min-height: 600px;
      }
      #bar-chart {
        min-height: 450px;
      }
      #placeholder {
        min-height: 600px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        font-size: 1.2rem;
      }
    </style>
  </head>
  <body>
    <div class="page-header">
      <h1>Visualization B - Plot 1: Radial Graphs</h1>
      <p class="subtitle">Trust in Government Agencies: Interactive Comparison Tool</p>
      <div class="header-controls">
        <input type="file" id="csv-uploader" accept=".csv" />
        <label for="csv-uploader" id="upload-label">Load New CSV</label>
        <span id="file-name">Loading default...</span>
      </div>
    </div>

    <div class="container">
      <div class="controls-panel">
        <div class="info-wrapper">
          <div class="info-container metric-info">
            <div class="info-icon">i</div>
            <span class="info-text">View Metric Definitions</span>
            <div class="info-tooltip" style="width: 300px">
              <h4>Metric Definitions</h4>
              <div class="def-item">
                <strong>Trust Dimensions (Radial):</strong>
              </div>
              <ul
                style="
                  padding-left: 15px;
                  margin: -5px 0 10px 0;
                  font-size: 0.85rem;
                "
              >
                <li><strong>Competence:</strong> Ability to execute.</li>
                <li><strong>Reliability:</strong> Consistency.</li>
                <li><strong>Ethics:</strong> Moral principles.</li>
                <li><strong>Sincerity:</strong> Honesty.</li>
                <li><strong>Benevolence:</strong> Care for public interest.</li>
              </ul>
              <div class="def-item">
                <strong>Warmth (Bar):</strong> Perceived friendliness & good
                intentions.
              </div>
              <div class="def-item">
                <strong>Dominance (Bar):</strong> Perceived power & capability.
              </div>
            </div>
          </div>

          <div class="info-container agency-info">
            <div class="info-icon">?</div>
            <span class="info-text">View Agency Full Names</span>
            <div class="info-tooltip" style="width: 760px">
              <h4>Agency Full Names</h4>
              <div class="agency-list-wrapper">
                <table class="agency-tooltip-table">
                  <tr>
                    <th>Short Name</th>
                    <th>Full Name</th>
                  </tr>
                  <tr>
                    <td>Amtrak</td>
                    <td>Amtrak</td>
                  </tr>
                  <tr>
                    <td>BPR</td>
                    <td>Bureau of Prisons (BPR)</td>
                  </tr>
                  <tr>
                    <td>CBP</td>
                    <td>Customs & Border Protection (CBP)</td>
                  </tr>
                  <tr>
                    <td>CDC</td>
                    <td>Center for Disease Control (CDC)</td>
                  </tr>
                  <tr>
                    <td>Census</td>
                    <td>Census Bureau</td>
                  </tr>
                  <tr>
                    <td>CISA</td>
                    <td>
                      Cybersecurity and Infrastructure Security Agency (CISA)
                    </td>
                  </tr>
                  <tr>
                    <td>DEd</td>
                    <td>Department of Education</td>
                  </tr>
                  <tr>
                    <td>DOD</td>
                    <td>Department of Defense (DoD)</td>
                  </tr>
                  <tr>
                    <td>DOJ</td>
                    <td>Department of Justice (DOJ)</td>
                  </tr>
                </table>

                <table class="agency-tooltip-table">
                  <tr>
                    <th>Short Name</th>
                    <th>Full Name</th>
                  </tr>
                  <tr>
                    <td>EPA</td>
                    <td>Environmental Protection Agency (EPA)</td>
                  </tr>
                  <tr>
                    <td>FAA</td>
                    <td>Federal Aviation Administration (FAA)</td>
                  </tr>
                  <tr>
                    <td>FairHousing</td>
                    <td>Office of Fair Housing and Equal Opportunity</td>
                  </tr>
                  <tr>
                    <td>FBI</td>
                    <td>Federal Bureau of Investigation (FBI)</td>
                  </tr>
                  <tr>
                    <td>FDA</td>
                    <td>Food & Drug Administration (FDA)</td>
                  </tr>
                  <tr>
                    <td>FEMA</td>
                    <td>Federal Emergency Management Agency (FEMA)</td>
                  </tr>
                  <tr>
                    <td>IRS</td>
                    <td>Internal Revenue Services (IRS)</td>
                  </tr>
                  <tr>
                    <td>LaborDept</td>
                    <td>Labor Department</td>
                  </tr>
                  <tr>
                    <td>Lib</td>
                    <td>Library of Congress</td>
                  </tr>
                </table>

                <table class="agency-tooltip-table">
                  <tr>
                    <th>Short Name</th>
                    <th>Full Name</th>
                  </tr>
                  <tr>
                    <td>Mus</td>
                    <td>Smithsonian Museums</td>
                  </tr>
                  <tr>
                    <td>NASA</td>
                    <td>National Aeronautics & Space Administration (NASA)</td>
                  </tr>
                  <tr>
                    <td>NEA</td>
                    <td>National Endowment for the Arts (NEA)</td>
                  </tr>
                  <tr>
                    <td>NSF</td>
                    <td>National Science Foundation (NSF)</td>
                  </tr>
                  <tr>
                    <td>SocSecurity</td>
                    <td>Social Security Administration</td>
                  </tr>
                  <tr>
                    <td>Treas</td>
                    <td>Treasury</td>
                  </tr>
                  <tr>
                    <td>TSA</td>
                    <td>Transportation Security Administration (TSA)</td>
                  </tr>
                  <tr>
                    <td>USPS</td>
                    <td>U.S. Postal Service (USPS)</td>
                  </tr>
                  <tr>
                    <td>Zoo</td>
                    <td>National Zoo</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="control-group">
          <label>Select Agencies to Compare</label>
          <div id="agency-checkbox-list">
            <p style="color: #777; margin: 0">Load CSV to populate list.</p>
          </div>
        </div>

        <h2>Currently Comparing</h2>
        <ul id="comparison-list">
          <li id="no-agencies-msg" style="color: #777">
            No agencies selected.
          </li>
        </ul>
      </div>

      <div class="viz-area">
        <div class="viz-card">
          <h3>Trust Dimensions (Radial)</h3>
          <div id="radar-chart">
            <div id="placeholder">Select agencies to see Trust Dimensions</div>
          </div>
        </div>
        <div class="viz-card">
          <h3>Warmth & Dominance (Bar)</h3>
          <div id="bar-chart"></div>
        </div>
      </div>
    </div>

    <script>
      // --- Globals ---
      const TRUST_DIMS = [
        "Competent",
        "Reliable",
        "Ethical",
        "Sincere",
        "Benevolent",
      ];
      const WD_DIMS = ["Warmth", "Dominance"];
      const AGENCY_COL = "Agency";

      // UI Elements
      const fileNameDisplay = document.getElementById("file-name");
      const fileInput = document.getElementById("csv-uploader");
      const agencyChecklist = document.getElementById("agency-checkbox-list");
      const comparisonList = document.getElementById("comparison-list");
      const noAgenciesMsg = document.getElementById("no-agencies-msg");
      const radarChartEl = document.getElementById("radar-chart");
      const barChartEl = document.getElementById("bar-chart");
      const placeholder = document.getElementById("placeholder");

      // State
      let allAgencyData = [];
      let comparedAgencies = new Map();
      const colorPalette = [
        "#0072B2", // Blue
        "#D55E00", // Reddish Orange
        "#009E73", // Green
        "#CC79A7", // Pink
        "#E69F00", // Orange
        "#56B4E9", // Sky Blue
        "#F0E442", // Yellow
        "#999999", // Gray
        "#8C564B", // Brown
        "#C4A484", // Tan
      ];

      // --- Core Functions ---

      function processCSV(parsedData) {
        if (!parsedData || !parsedData.length || !parsedData[0][AGENCY_COL]) {
          alert(
            "Error: Invalid CSV file. Make sure it has an 'Agency' column and all metric columns."
          );
          return;
        }

        try {
          allAgencyData = parsedData
            .map((row) => {
              const data = { Agency: row[AGENCY_COL] };
              let isValid = true;
              let trustSum = 0;
              let trustCount = 0;

              [...TRUST_DIMS, ...WD_DIMS].forEach((col) => {
                const val = parseFloat(row[col]);
                if (isNaN(val)) isValid = false;
                data[col] = val;

                if (TRUST_DIMS.includes(col)) {
                  trustSum += val;
                  trustCount++;
                }
              });

              if (trustCount > 0) {
                data.Trust = trustSum / trustCount;
              } else {
                isValid = false;
              }

              return isValid ? data : null;
            })
            .filter((d) => d && d.Agency);

          if (allAgencyData.length === 0) {
            throw new Error("No valid agency data found in CSV.");
          }

          const existingComparedNames = Array.from(comparedAgencies.keys());
          comparedAgencies.clear();
          existingComparedNames.forEach((name) => {
            const found = allAgencyData.find((d) => d.Agency === name);
            if (found) comparedAgencies.set(name, found);
          });

          populateAgencyChecklist();
          updateComparisonList();
          drawCharts();
        } catch (error) {
          alert(`Error processing data: ${error.message}`);
        }
      }

      function populateAgencyChecklist() {
        agencyChecklist.innerHTML = "";

        allAgencyData
          .sort((a, b) => a.Agency.localeCompare(b.Agency))
          .forEach((d) => {
            const agencyName = d.Agency;
            const item = document.createElement("div");
            item.className = "checkbox-item";

            const input = document.createElement("input");
            input.type = "checkbox";
            input.id = `check-${agencyName}`;
            input.value = agencyName;
            input.checked = comparedAgencies.has(agencyName);
            input.addEventListener("change", handleCheckboxChange);

            const label = document.createElement("label");
            label.htmlFor = `check-${agencyName}`;
            label.textContent = agencyName;

            item.appendChild(input);
            item.appendChild(label);
            agencyChecklist.appendChild(item);
          });
      }

      function handleCheckboxChange(event) {
        const agencyName = event.target.value;
        if (event.target.checked) {
          const agencyData = allAgencyData.find((d) => d.Agency === agencyName);
          if (agencyData) {
            comparedAgencies.set(agencyName, agencyData);
          }
        } else {
          comparedAgencies.delete(agencyName);
        }
        updateComparisonList();
        drawCharts();
      }

      function updateComparisonList() {
        comparisonList.innerHTML = "";
        if (comparedAgencies.size === 0) {
          comparisonList.appendChild(noAgenciesMsg);
          return;
        }

        let i = 0;
        Array.from(comparedAgencies.keys()).forEach((name) => {
          const data = comparedAgencies.get(name);
          const color = colorPalette[i % colorPalette.length];
          const item = document.createElement("li");
          item.className = "comparison-item";
          item.innerHTML = `
                    <span class="comparison-item-name">
                        <span class="color-swatch" style="background-color: ${color};"></span>
                        ${name}
                    </span>
                    `;
          comparisonList.appendChild(item);
          i++;
        });
      }

      function drawCharts() {
        let agencies = Array.from(comparedAgencies.values());

        if (agencies.length === 0) {
          radarChartEl.innerHTML = "";
          barChartEl.innerHTML = "";
          if (!document.getElementById("placeholder")) {
            radarChartEl.appendChild(placeholder);
          }
          return;
        }

        agencies.sort((a, b) => a.Trust - b.Trust);

        drawRadialChart(agencies);
        drawBarChart(agencies);
      }

      function drawRadialChart(agencies) {
        if (placeholder && placeholder.parentElement) placeholder.remove();
        const traces = [];
        const theta = [...TRUST_DIMS, TRUST_DIMS[0]];

        agencies.forEach((agency, i) => {
          const color = colorPalette[i % colorPalette.length];
          const r = TRUST_DIMS.map((dim) => agency[dim]);
          r.push(r[0]);

          traces.push({
            type: "scatterpolar",
            r: r,
            theta: theta,
            fill: "toself",
            fillcolor: color + "33",
            line: { color: color, width: 2 },
            name: agency.Agency,
            hovertemplate: `<b>${agency.Agency}</b><br>%{theta}: %{r:.2f}<extra></extra>`,
          });
        });

        const layout = {
          polar: {
            radialaxis: {
              visible: true,
              range: [0, 7],
              tickvals: [0, 1, 2, 3, 4, 5, 6, 7],
              ticklen: 8,
              linecolor: "#ddd",
            },
            angularaxis: {
              rotation: 90,
              direction: "clockwise",
              linecolor: "#ddd",
            },
          },
          showlegend: true,
          legend: {
            x: 1.05,
            y: 0.5,
            xanchor: "left",
            yanchor: "middle",
          },
          margin: { t: 50, b: 50, l: 50, r: 200 },
        };

        Plotly.newPlot(radarChartEl, traces, layout, {
          responsive: true,
          displayModeBar: false,
        });
      }

      function drawBarChart(agencies) {
        barChartEl.innerHTML = "";

        const agenciesInListOrder = Array.from(comparedAgencies.keys())
          .map((name) => agencies.find((a) => a.Agency === name))
          .filter((a) => a);

        const traces = agenciesInListOrder.map((agency, i) => {
          const color = colorPalette[i % colorPalette.length];
          return {
            type: "bar",
            x: WD_DIMS,
            y: WD_DIMS.map((dim) => agency[dim]),
            name: agency.Agency,
            marker: {
              color: color,
            },
          };
        });

        const layout = {
          barmode: "group",
          showlegend: true,
          yaxis: { title: "Score" },
          xaxis: { tickangle: 0 },
          margin: { t: 50, b: 50, l: 50, r: 50 },
        };

        Plotly.newPlot(barChartEl, traces, layout, {
          responsive: true,
          displayModeBar: false,
        });
      }

      // --- Event Listeners ---

      document.addEventListener("DOMContentLoaded", () => {
        fetch("data/agency.csv")
          .then((response) => {
            if (!response.ok)
              throw new Error("Could not find default 'agency.csv'.");
            return response.text();
          })
          .then((csvText) => {
            fileNameDisplay.textContent = "agency.csv (default)";
            Papa.parse(csvText, {
              header: true,
              dynamicTyping: false,
              skipEmptyLines: true,
              complete: (results) => processCSV(results.data),
              error: (err) =>
                alert(`Error parsing default CSV: ${err.message}`),
            });
          })
          .catch((err) => {
            alert(`Error loading default data: ${err.message}`);
            fileNameDisplay.textContent = "No file loaded.";
          });
      });

      fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file) {
          fileNameDisplay.textContent = file.name;
          Papa.parse(file, {
            header: true,
            dynamicTyping: false,
            skipEmptyLines: true,
            complete: (results) => processCSV(results.data),
            error: (err) => {
              alert(`Error parsing file: ${err.message}`);
            },
          });
        }
      });
    </script>
  </body>
</html>




<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PLOT 1: Radial/Bar Comparison | Visualisation B (PLOT 1):Trust in Gov</title>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
      :root {
        --primary-color: #2c5f7f;
        --bg-color: #f8f9fa;
        --text-color: #333;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Navigation Bar */
      nav {
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 100;
        position: relative;
      }
      .nav-brand {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
        text-decoration: none;
      }
      .nav-links {
        display: flex;
        gap: 20px;
        align-items: center;
      }
      .nav-item {
        text-decoration: none;
        color: #666;
        font-weight: 500;
        padding: 8px 16px;
        border-radius: 6px;
        transition: all 0.2s ease;
      }
      .nav-item:hover {
        background-color: #eef2f5;
        color: var(--primary-color);
      }
      .nav-item.active {
        background-color: var(--primary-color);
        color: white;
      }

      /* File Uploader */
      #csv-uploader {
        display: none;
      }
      #upload-label {
        display: inline-block;
        background-color: #eef2f5;
        color: var(--primary-color);
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      #upload-label:hover {
        background-color: #dbe4eb;
      }
      #file-name {
        font-size: 0.8rem;
        color: #777;
        margin-left: 10px;
      }

      /* Main Layout */
      .container {
        flex: 1;
        max-width: 1600px;
        margin: 20px auto;
        padding: 0 20px;
        width: 100%;
        box-sizing: border-box;
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 20px;
      }

      /* Controls Panel */
      .controls-panel {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        padding: 20px;
        align-self: start;
      }
      .controls-panel h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
      }
      .control-group {
        margin-bottom: 20px;
      }
      .control-group label {
        display: block;
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 8px;
      }

      /* Agency Checkbox List Styles */
      #agency-checkbox-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #eee;
        border-radius: 6px;
        padding: 10px;
        background: #fcfcfc;
      }
      .checkbox-item {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
      }
      .checkbox-item input {
        margin-right: 8px;
        cursor: pointer;
      }
      .checkbox-item label {
        font-weight: 400; /* Normal weight for label text */
        margin-bottom: 0;
        cursor: pointer;
        user-select: none;
      }

      /* --- NEW/UPDATED Info Button & Tooltip Styles for Radial Page --- */
      /* Wrapper to hold both info buttons vertically in the controls panel */
      .info-wrapper {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-bottom: 20px;
        /* Removed padding-top and border-top to place them at the very top */
      }
      .info-container {
        position: relative;
        z-index: 10;
        display: flex;
        align-items: center;
      }
      .info-icon {
        width: 28px;
        height: 28px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-family: serif;
        font-style: italic;
        cursor: help;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        font-size: 16px;
      }
      .info-text {
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--primary-color);
        margin-left: 10px;
      }

      .info-tooltip {
        visibility: hidden;
        background-color: #fff;
        color: #333;
        text-align: left;
        border-radius: 8px;
        padding: 15px;
        position: absolute;
        /* Position tooltip to the right of the entire panel */
        top: -15px;
        left: 105%;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.9rem;
        line-height: 1.4;
        border: 1px solid #eee;
        pointer-events: none;
      }
      /* Agency specific styles */
      .info-container.agency-info .info-tooltip {
        max-height: 70vh;
        overflow-y: auto;
      }

      .info-container:hover .info-tooltip {
        visibility: visible;
        opacity: 1;
      }
      .info-tooltip h4 {
        margin-top: 0;
        color: var(--primary-color);
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
      }
      .info-tooltip strong {
        color: #444;
      }
      .def-item {
        margin-bottom: 8px;
      }
      .agency-list-wrapper {
        display: flex;
        gap: 15px; /* Space between columns */
        margin-top: 10px;
      }
      .agency-tooltip-table {
        flex: 1; /* Distribute space evenly among the tables */
        border-collapse: collapse;
        font-size: 0.85rem;
      }
      .agency-tooltip-table th,
      .agency-tooltip-table td {
        border-bottom: 1px solid #eee;
        padding: 6px 0;
        text-align: left;
      }
      .agency-tooltip-table th {
        font-weight: bold;
        color: var(--primary-color);
        padding-bottom: 8px;
      }
      /* END Info Button Styles */

      /* Comparison List - Used to show selected agencies with color */
      #comparison-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .comparison-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 8px;
        background: #f8f9fa;
      }
      .comparison-item-name {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
      }
      .color-swatch {
        width: 12px;
        height: 12px;
        border-radius: 3px;
        display: inline-block;
        border: 1px solid #33333366; /* Added border for white/yellow colors */
      }

      /* Visualization Area */
      .viz-area {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .viz-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        padding: 20px;
        position: relative;
        flex: 1;
      }
      .viz-card h3 {
        margin-top: 0;
        color: #333;
      }
      /* --- INCREASED RADAR CHART HEIGHT --- */
      #radar-chart,
      #bar-chart {
        width: 100%;
        min-height: 600px; /* Increased height */
      }
      #bar-chart {
        min-height: 450px; /* Keep bar chart a normal size */
      }
      #placeholder {
        min-height: 600px; /* Increased height */
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        font-size: 1.2rem;
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="index.html" class="nav-brand">Trust in Gov</a>
      <div class="nav-links">
        <input type="file" id="csv-uploader" accept=".csv" />
        <label for="csv-uploader" id="upload-label">Load New CSV</label>
        <span id="file-name">Loading default...</span>

        <a href="index.html" class="nav-item">High-Dimensional (UMAP)</a>
        <a href="radial.html" class="nav-item active">PLOT 1: Radial/Bar Views</a>
      </div>
    </nav>

    <div class="container">
      <div class="controls-panel">
        <div class="info-wrapper">
          <div class="info-container metric-info">
            <div class="info-icon">i</div>
            <span class="info-text">View Metric Definitions</span>
            <div class="info-tooltip" style="width: 300px">
              <h4>Metric Definitions</h4>
              <div class="def-item">
                <strong>Trust Dimensions (Radial):</strong>
              </div>
              <ul
                style="
                  padding-left: 15px;
                  margin: -5px 0 10px 0;
                  font-size: 0.85rem;
                "
              >
                <li><strong>Competence:</strong> Ability to execute.</li>
                <li><strong>Reliability:</strong> Consistency.</li>
                <li><strong>Ethics:</strong> Moral principles.</li>
                <li><strong>Sincerity:</strong> Honesty.</li>
                <li><strong>Benevolence:</strong> Care for public interest.</li>
              </ul>
              <div class="def-item">
                <strong>Warmth (Bar):</strong> Perceived friendliness & good
                intentions.
              </div>
              <div class="def-item">
                <strong>Dominance (Bar):</strong> Perceived power & capability.
              </div>
            </div>
          </div>

          <div class="info-container agency-info">
            <div class="info-icon">?</div>
            <span class="info-text">View Agency Full Names</span>
            <div class="info-tooltip" style="width: 760px">
              <h4>Agency Full Names</h4>
              <div class="agency-list-wrapper">
                <table class="agency-tooltip-table">
                  <tr>
                    <th>Short Name</th>
                    <th>Full Name</th>
                  </tr>
                  <tr>
                    <td>Amtrak</td>
                    <td>Amtrak</td>
                  </tr>
                  <tr>
                    <td>BPR</td>
                    <td>Bureau of Prisons (BPR)</td>
                  </tr>
                  <tr>
                    <td>CBP</td>
                    <td>Customs & Border Protection (CBP)</td>
                  </tr>
                  <tr>
                    <td>CDC</td>
                    <td>Center for Disease Control (CDC)</td>
                  </tr>
                  <tr>
                    <td>Census</td>
                    <td>Census Bureau</td>
                  </tr>
                  <tr>
                    <td>CISA</td>
                    <td>
                      Cybersecurity and Infrastructure Security Agency (CISA)
                    </td>
                  </tr>
                  <tr>
                    <td>DEd</td>
                    <td>Department of Education</td>
                  </tr>
                  <tr>
                    <td>DOD</td>
                    <td>Department of Defense (DoD)</td>
                  </tr>
                  <tr>
                    <td>DOJ</td>
                    <td>Department of Justice (DOJ)</td>
                  </tr>
                </table>

                <table class="agency-tooltip-table">
                  <tr>
                    <th>Short Name</th>
                    <th>Full Name</th>
                  </tr>
                  <tr>
                    <td>EPA</td>
                    <td>Environmental Protection Agency (EPA)</td>
                  </tr>
                  <tr>
                    <td>FAA</td>
                    <td>Federal Aviation Administration (FAA)</td>
                  </tr>
                  <tr>
                    <td>FairHousing</td>
                    <td>Office of Fair Housing and Equal Opportunity</td>
                  </tr>
                  <tr>
                    <td>FBI</td>
                    <td>Federal Bureau of Investigation (FBI)</td>
                  </tr>
                  <tr>
                    <td>FDA</td>
                    <td>Food & Drug Administration (FDA)</td>
                  </tr>
                  <tr>
                    <td>FEMA</td>
                    <td>Federal Emergency Management Agency (FEMA)</td>
                  </tr>
                  <tr>
                    <td>IRS</td>
                    <td>Internal Revenue Services (IRS)</td>
                  </tr>
                  <tr>
                    <td>LaborDept</td>
                    <td>Labor Department</td>
                  </tr>
                  <tr>
                    <td>Lib</td>
                    <td>Library of Congress</td>
                  </tr>
                </table>

                <table class="agency-tooltip-table">
                  <tr>
                    <th>Short Name</th>
                    <th>Full Name</th>
                  </tr>
                  <tr>
                    <td>Mus</td>
                    <td>Smithsonian Museums</td>
                  </tr>
                  <tr>
                    <td>NASA</td>
                    <td>National Aeronautics & Space Administration (NASA)</td>
                  </tr>
                  <tr>
                    <td>NEA</td>
                    <td>National Endowment for the Arts (NEA)</td>
                  </tr>
                  <tr>
                    <td>NSF</td>
                    <td>National Science Foundation (NSF)</td>
                  </tr>
                  <tr>
                    <td>SocSecurity</td>
                    <td>Social Security Administration</td>
                  </tr>
                  <tr>
                    <td>Treas</td>
                    <td>Treasury</td>
                  </tr>
                  <tr>
                    <td>TSA</td>
                    <td>Transportation Security Administration (TSA)</td>
                  </tr>
                  <tr>
                    <td>USPS</td>
                    <td>U.S. Postal Service (USPS)</td>
                  </tr>
                  <tr>
                    <td>Zoo</td>
                    <td>National Zoo</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="control-group">
          <label>Select Agencies to Compare</label>
          <div id="agency-checkbox-list">
            <p style="color: #777; margin: 0">Load CSV to populate list.</p>
          </div>
        </div>

        <h2>Currently Comparing</h2>
        <ul id="comparison-list">
          <li id="no-agencies-msg" style="color: #777">
            No agencies selected.
          </li>
        </ul>
      </div>

      <div class="viz-area">
        <div class="viz-card">
          <h3>Trust Dimensions (Radial)</h3>
          <div id="radar-chart">
            <div id="placeholder">Select agencies to see Trust Dimensions</div>
          </div>
        </div>
        <div class="viz-card">
          <h3>Warmth & Dominance (Bar)</h3>
          <div id="bar-chart"></div>
        </div>
      </div>
    </div>

    <script>
      // --- Globals ---
      const TRUST_DIMS = [
        "Competent",
        "Reliable",
        "Ethical",
        "Sincere",
        "Benevolent",
      ];
      const WD_DIMS = ["Warmth", "Dominance"];
      const AGENCY_COL = "Agency";

      // UI Elements
      const fileNameDisplay = document.getElementById("file-name");
      const fileInput = document.getElementById("csv-uploader");
      const agencyChecklist = document.getElementById("agency-checkbox-list");
      const comparisonList = document.getElementById("comparison-list");
      const noAgenciesMsg = document.getElementById("no-agencies-msg");
      const radarChartEl = document.getElementById("radar-chart");
      const barChartEl = document.getElementById("bar-chart");
      const placeholder = document.getElementById("placeholder");

      // State
      let allAgencyData = [];
      let comparedAgencies = new Map(); // Map<string, object>
      // --- NEW HIGH-CONTRAST COLOR PALETTE ---
      const colorPalette = [
        "#0072B2", // Blue
        "#D55E00", // Reddish Orange
        "#009E73", // Green
        "#CC79A7", // Pink
        "#E69F00", // Orange
        "#56B4E9", // Sky Blue
        "#F0E442", // Yellow
        "#999999", // Gray
        "#8C564B", // Brown
        "#C4A484", // Tan
      ];

      // --- Core Functions ---

      /**
       * Takes raw CSV data, processes, and stores it.
       */
      function processCSV(parsedData) {
        if (!parsedData || !parsedData.length || !parsedData[0][AGENCY_COL]) {
          alert(
            "Error: Invalid CSV file. Make sure it has an 'Agency' column and all metric columns."
          );
          return;
        }

        try {
          allAgencyData = parsedData
            .map((row) => {
              const data = { Agency: row[AGENCY_COL] };
              let isValid = true;
              let trustSum = 0;
              let trustCount = 0; // Added for robustness

              [...TRUST_DIMS, ...WD_DIMS].forEach((col) => {
                const val = parseFloat(row[col]);
                if (isNaN(val)) isValid = false;
                data[col] = val;

                // --- NEW: Calculate Trust Sum for sorting ---
                if (TRUST_DIMS.includes(col)) {
                  trustSum += val;
                  trustCount++;
                }
              });

              if (trustCount > 0) {
                data.Trust = trustSum / trustCount; // Add Trust score (Average)
              } else {
                isValid = false;
              }

              return isValid ? data : null;
            })
            .filter((d) => d && d.Agency);

          if (allAgencyData.length === 0) {
            throw new Error("No valid agency data found in CSV.");
          }

          // Reset state and populate new checklist
          // Re-establish compared agencies from the new data based on names
          const existingComparedNames = Array.from(comparedAgencies.keys());
          comparedAgencies.clear();
          existingComparedNames.forEach((name) => {
            const found = allAgencyData.find((d) => d.Agency === name);
            if (found) comparedAgencies.set(name, found);
          });

          populateAgencyChecklist();
          updateComparisonList();
          drawCharts();
        } catch (error) {
          alert(`Error processing data: ${error.message}`);
        }
      }

      /**
       * Fills the Checkbox list with agency names and sets up the listener.
       */
      function populateAgencyChecklist() {
        agencyChecklist.innerHTML = ""; // Clear previous list

        allAgencyData
          .sort((a, b) => a.Agency.localeCompare(b.Agency))
          .forEach((d) => {
            const agencyName = d.Agency;
            const item = document.createElement("div");
            item.className = "checkbox-item";

            const input = document.createElement("input");
            input.type = "checkbox";
            input.id = `check-${agencyName}`;
            input.value = agencyName;
            input.checked = comparedAgencies.has(agencyName); // Retain checked state
            input.addEventListener("change", handleCheckboxChange);

            const label = document.createElement("label");
            label.htmlFor = `check-${agencyName}`;
            label.textContent = agencyName;

            item.appendChild(input);
            item.appendChild(label);
            agencyChecklist.appendChild(item);
          });
      }

      /**
       * Handles adding/removing agencies when a checkbox is toggled.
       */
      function handleCheckboxChange(event) {
        const agencyName = event.target.value;
        if (event.target.checked) {
          // Add agency
          const agencyData = allAgencyData.find((d) => d.Agency === agencyName);
          if (agencyData) {
            comparedAgencies.set(agencyName, agencyData);
          }
        } else {
          // Remove agency
          comparedAgencies.delete(agencyName);
        }
        updateComparisonList();
        drawCharts();
      }

      /**
       * Re-draws the list of compared agencies
       */
      function updateComparisonList() {
        comparisonList.innerHTML = ""; // Clear list
        if (comparedAgencies.size === 0) {
          comparisonList.appendChild(noAgenciesMsg);
          return;
        }

        let i = 0;
        // Use the map keys for ordering consistency
        Array.from(comparedAgencies.keys()).forEach((name) => {
          const data = comparedAgencies.get(name);
          const color = colorPalette[i % colorPalette.length];
          const item = document.createElement("li");
          item.className = "comparison-item";
          item.innerHTML = `
                    <span class="comparison-item-name">
                        <span class="color-swatch" style="background-color: ${color};"></span>
                        ${name}
                    </span>
                    `;
          comparisonList.appendChild(item);
          i++;
        });
      }

      /**
       * Main render function
       */
      function drawCharts() {
        let agencies = Array.from(comparedAgencies.values());

        if (agencies.length === 0) {
          radarChartEl.innerHTML = "";
          barChartEl.innerHTML = "";
          // Restore placeholder
          if (!document.getElementById("placeholder")) {
            radarChartEl.appendChild(placeholder);
          }
          return;
        }

        // --- NEW: Automatic Ordering by Trust Score (Lowest to Highest) ---
        // This ensures smaller polygons are drawn first, preventing occlusion.
        agencies.sort((a, b) => a.Trust - b.Trust);

        drawRadialChart(agencies);
        drawBarChart(agencies);
      }

      /**
       * Draws the Polar/Radar chart for Trust Dimensions
       */
      function drawRadialChart(agencies) {
        if (placeholder && placeholder.parentElement) placeholder.remove(); // Remove placeholder
        const traces = [];
        const theta = [...TRUST_DIMS, TRUST_DIMS[0]]; // Close the loop

        agencies.forEach((agency, i) => {
          // Use the index *after* sorting for color
          const color = colorPalette[i % colorPalette.length];
          const r = TRUST_DIMS.map((dim) => agency[dim]);
          r.push(r[0]); // Close the loop

          traces.push({
            type: "scatterpolar",
            r: r,
            theta: theta,
            fill: "toself",
            fillcolor: color + "33", // Add alpha transparency
            line: { color: color, width: 2 },
            name: agency.Agency,
            // Ensure hover info is detailed
            hovertemplate: `<b>${agency.Agency}</b><br>%{theta}: %{r:.2f}<extra></extra>`,
          });
        });

        const layout = {
          polar: {
            radialaxis: {
              visible: true,
              range: [0, 7], // Assuming a 0-7 scale
              tickvals: [0, 1, 2, 3, 4, 5, 6, 7],
              ticklen: 8,
              linecolor: "#ddd",
            },
            angularaxis: {
              // Ensure labels are centered under the dimension name
              rotation: 90,
              direction: "clockwise",
              linecolor: "#ddd",
            },
          },
          showlegend: true,
          legend: {
            x: 1.05,
            y: 0.5,
            xanchor: "left",
            yanchor: "middle",
          },
          // Margin updated for the larger graph size
          margin: { t: 50, b: 50, l: 50, r: 200 },
        };

        Plotly.newPlot(radarChartEl, traces, layout, {
          responsive: true,
          displayModeBar: false,
        });
      }

      /**
       * Draws the Bar chart for Warmth & Dominance
       */
      function drawBarChart(agencies) {
        barChartEl.innerHTML = "";

        // Reset index for colors to match the order in comparison list
        const agenciesByName = agencies.map((a) => a.Agency);
        const agenciesInListOrder = Array.from(comparedAgencies.keys())
          .map((name) => agencies.find((a) => a.Agency === name))
          .filter((a) => a); // Filter out any undefined

        const traces = agenciesInListOrder.map((agency, i) => {
          const color = colorPalette[i % colorPalette.length];
          return {
            type: "bar",
            x: WD_DIMS, // X-axis categories are ['Warmth', 'Dominance']
            y: WD_DIMS.map((dim) => agency[dim]), // Get the values [agency.Warmth, agency.Dominance]
            name: agency.Agency,
            marker: {
              color: color, // Apply the agency's consistent color
            },
          };
        });

        const layout = {
          barmode: "group",
          showlegend: true,
          yaxis: { title: "Score" },
          xaxis: { tickangle: 0 },
          margin: { t: 50, b: 50, l: 50, r: 50 },
        };

        Plotly.newPlot(barChartEl, traces, layout, {
          responsive: true,
          displayModeBar: false,
        });
      }

      // --- Event Listeners ---

      // 1. Load default data
      document.addEventListener("DOMContentLoaded", () => {
        fetch("data/agency.csv")
          .then((response) => {
            if (!response.ok)
              throw new Error("Could not find default 'agency.csv'.");
            return response.text();
          })
          .then((csvText) => {
            fileNameDisplay.textContent = "agency.csv (default)";
            Papa.parse(csvText, {
              header: true,
              dynamicTyping: false,
              skipEmptyLines: true,
              complete: (results) => processCSV(results.data),
              error: (err) =>
                alert(`Error parsing default CSV: ${err.message}`),
            });
          })
          .catch((err) => {
            alert(`Error loading default data: ${err.message}`);
            fileNameDisplay.textContent = "No file loaded.";
          });
      });

      // 2. Listen for user-uploaded file
      fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file) {
          fileNameDisplay.textContent = file.name;
          Papa.parse(file, {
            header: true,
            dynamicTyping: false,
            skipEmptyLines: true,
            complete: (results) => processCSV(results.data),
            error: (err) => {
              alert(`Error parsing file: ${err.message}`);
            },
          });
        }
      });
    </script>
  </body>
</html> -->
